#!/usr/bin/env zsh
dir=$PROJECT_DIR/versioned/paper
cd $dir

infile=text/body.md
output="output/Crystal-Knob.docx"
bibfile="source/references.bib"

# Process body text
# Correct for pandoc-crossref annoyingness
cat text/abstract.md text/chapters/*.md \
| sed -r "s/\[((@(fig|eq|sec|tab):\w+;? ?)*)\]/\\\[\1\\\]/g" \
| pandoc -t docx --metadata=draft:true \
       --filter pandoc-comments \
       --filter pandoc-crossref \
       --bibliography=$bibfile \
       --csl="source/lib/agu.csl" -o $output

